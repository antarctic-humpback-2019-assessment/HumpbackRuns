---
title: "January Humpback Runs"
author: "Grant Adams"
date: "January 10, 2019"
output: word_document
---

```{r, echo = FALSE}
# DATA Set up

# Load data
setwd("12_2018_Runs")
source("InputData_HWAssessment_InitialAssessments_Oct2018.R")
library(HumpbackSIR)

# Reference
Core.1901.1938 <- Core.Catches[Core.Catches$Year %in% c(1901:1938), ]
Core.1939.1945 <- Core.Catches[Core.Catches$Year %in% c(1939:1945), ]
Core.1946.present <- Core.Catches[Core.Catches$Year > 1945, ]
Core.Catches.Reorg <- merge(Core.1901.1938, Core.1939.1945, by = "Year", all = TRUE)
Core.Catches.Reorg <- merge(Core.Catches.Reorg, Core.1946.present, by = "Year", all = TRUE)

sir_reference <- list()
Rel.Abundance.Branch$ Index <- 2
rel_abund <- rbind(Rel.Abundance.Pavanato, Rel.Abundance.Branch)
```


```{r pressure, echo=FALSE, out.width = '100%'}
# SDATA 1
file_name <- "Reference/Reference"
for(i in 1:2){
  sir_reference[[i]] <-  HUMPBACK.SIR(file_name = paste0(file_name, c("","prior")[i]),
                                      n_resamples = 10000,
                                      priors = make_prior_list(r_max = make_prior(runif, 0, 0.118),
                                                               N_obs = make_prior(runif, 500, 40000)),
                                      catch_multipliers = make_multiplier_list(
                                        make_prior(rbest, 0.139, 0.3),
                                        make_prior(runif, 1.25, 1.42), 
                                        make_prior(rnorm, 1.0185, 0.0028)),
                                      premodern_catch_multipliers = make_multiplier_list(
                                        make_prior(rnorm, 1.71, 0.073)),
                                      target.Yr = 2008,
                                      num.haplotypes = 0,
                                      output.Yrs = c(2012, 2018),
                                      abs.abundance = rbind(Abs.Abundance.2008, Abs.Abundance.2012),
                                      rel.abundance = rel_abund,
                                      rel.abundance.key = TRUE, # Indices of abundance
                                      count.data = Count.Data,
                                      count.data.key = FALSE,
                                      growth.rate.obs = c(0.074, 0.033, FALSE), # Do not include growth rate
                                      growth.rate.Yrs = c(1995, 1996, 1997, 1998),
                                      catch.data = Core.Catches.Reorg,
                                      premodern_catch_data = merge(PreModern.Catch.Min, PreModern.Catch.Max, by = "Year", all = T),
                                      control = sir_control(threshold = 1e-23, progress_bar = TRUE),
                                      realized_prior = ifelse(1, "FALSE", "TRUE"))
}
resample_summary_reference <- summary_sir(sir_reference$resamples_output, object = "Resample_Summary", file_name = file_name)
trajectory_summary_reference <- summary_sir(sir_reference$resamples_trajectories, object = "Trajectory_Summary", file_name = file_name)
plot_trajectory(sir_reference,  file_name = file_name)
plot_density(sir_reference,  file_name = file_name, multiple_sirs = TRUE, lower = c(NA, 22000, 0, NA, 20000, 0, 0.35, 0.6), upper = c(NA, 40000, 2000, NA, 28000, 0.1, NA, NA))
save(sir_reference, file = paste0(file_name, ".Rdata"))
zerbini_table(sir_reference,  file_name = file_name)

#
knitr::include_graphics(paste0(file_name, "_trajectory_summary", ".tiff"))
```



```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
